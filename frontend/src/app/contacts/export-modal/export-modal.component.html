<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" (click)="closeModal()">
    <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-full mx-4 border-2 border-primary-200" (click)="$event.stopPropagation()">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold text-gray-900">Exportar CSV</h2>
            <button (click)="closeModal()" class="text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                </svg>
            </button>
        </div>

        @if (!contactId) {
        <div class="bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg mb-4 text-sm">
            <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>Se exportarán las transacciones de <strong>todos los contactos</strong> en el rango de fechas seleccionado.</span>
            </div>
        </div>
        }

        @if (error) {
        <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4 text-sm">
            {{ error }}
        </div>
        }

        <form (ngSubmit)="export()" class="space-y-4">
            <!-- Start Date Section -->
            <div>
                <div class="flex items-center mb-2">
                    <input type="checkbox" id="noStartLimit" [(ngModel)]="noStartLimit" name="noStartLimit"
                        class="w-4 h-4 text-primary-600 rounded focus:ring-primary-500">
                    <label for="noStartLimit" class="ml-2 text-sm font-medium text-gray-700">
                        Desde el inicio (sin límite de fecha inicial)
                    </label>
                </div>

                @if (!noStartLimit) {
                <div>
                    <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">Fecha de inicio</label>
                    <input type="date" id="startDate" [(ngModel)]="startDate" name="startDate"
                        class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                </div>
                }
            </div>

            <!-- End Date Section -->
            <div>
                <div class="flex items-center mb-2">
                    <input type="checkbox" id="untilNow" [(ngModel)]="untilNow" name="untilNow"
                        class="w-4 h-4 text-primary-600 rounded focus:ring-primary-500">
                    <label for="untilNow" class="ml-2 text-sm font-medium text-gray-700">
                        Hasta ahora (fecha actual)
                    </label>
                </div>

                @if (!untilNow) {
                <div>
                    <label for="endDate" class="block text-sm font-medium text-gray-700 mb-1">Fecha de fin</label>
                    <input type="date" id="endDate" [(ngModel)]="endDate" name="endDate"
                        class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                </div>
                }
            </div>

            <!-- Buttons -->
            <div class="flex gap-3 pt-4">
                <button type="submit" [disabled]="loading"
                    class="flex-1 px-6 py-3 bg-warning-600 text-white font-medium hover:bg-warning-700 transition-colors disabled:opacity-50 rounded-lg shadow-md hover:shadow-lg">
                    {{ loading ? 'Exportando...' : 'Descargar CSV' }}
                </button>
                <button type="button" (click)="closeModal()"
                    class="px-6 py-3 bg-gray-100 text-gray-700 font-medium hover:bg-gray-200 transition-colors">
                    Cancelar
                </button>
            </div>
        </form>
    </div>
</div>